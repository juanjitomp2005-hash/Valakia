{% extends 'pages/base.html' %}
{% load static %} 
{% block title %} {{title}} {% endblock %}
{% block header_title %} {{subtitle}} {% endblock %}
{% block content %}
<div class="container my-5 d-flex justify-content-center">
  <div class="card shadow-lg p-4" style="max-width: 700px; width: 100%; border-radius: 1.5rem;">
    <div class="row g-0 align-items-center">
      <div class="col-md-5 text-center">
        {% if product.image %}
          <img src="{{ product.image.url }}" class="img-fluid rounded mb-3" style="max-height: 260px; object-fit: contain;">
        {% else %}
          <img src="{% static 'pages/img/air.webp' %}" class="img-fluid rounded mb-3" style="max-height: 260px; object-fit: contain;">
        {% endif %}
      </div>
      <div class="col-md-7">
        <div class="card-body">
          <h2 class="card-title mb-3 fw-bold text-red-900" style="font-size:2rem;">{{ product.name }}</h2>
          <p class="text-muted mb-2" style="font-size:1.1rem;">{{ product.descripcion }}</p>
          <p class="mb-2"><span class="badge bg-secondary">Vendidos: {{ product.cantidad_vendidos }}</span></p>
          <p class="h4 mb-4 text-success">${{ product.price }} COP</p>
          <button type="button" class="btn btn-success btn-lg add-to-cart-btn" data-product-id="{{ product.id }}" data-csrf-token="{{ csrf_token }}">AÃ±adir al carrito</button>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.add-to-cart-btn').forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        const productId = btn.getAttribute('data-product-id');
        const csrfToken = btn.getAttribute('data-csrf-token');
        fetch(`/cart/add/${productId}/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrfToken,
            'X-Requested-With': 'XMLHttpRequest',
          },
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            confetti({
              particleCount: 100,
              spread: 70,
              origin: { y: 0.7 }
            });
            // Actualizar contador carrito
            document.querySelectorAll('.cart-count-badge').forEach(function(el){
              el.textContent = data.cart_count;
              el.style.display = data.cart_count > 0 ? '' : 'none';
            });
          }
        });
      });
    });
  });
</script>
{% endblock %}